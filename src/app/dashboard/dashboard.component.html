<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-text">
        <h1>Dashboard de Administraci√≥n</h1>
        <p class="dashboard-subtitle">Panel de control de incidentes</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="goBack()" class="back-btn">
          <mat-icon>arrow_back</mat-icon>
          Volver Atr√°s
        </button>
      </div>
    </div>
  </div>

  <!-- Estad√≠sticas Generales -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <h3>{{dateStats.total}}</h3>
        <p>Total de Issues</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üìÖ</div>
      <div class="stat-content">
        <h3>{{dateStats.today}}</h3>
        <p>Creados Hoy</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üóìÔ∏è</div>
      <div class="stat-content">
        <h3>{{dateStats.lastWeek}}</h3>
        <p>√öltima Semana</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üóÇÔ∏è</div>
      <div class="stat-content">
        <h3>{{dateStats.lastMonth}}</h3>
        <p>√öltimo Mes</p>
      </div>
    </div>
  </div>

  <!-- Filtros de B√∫squeda -->
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-card-title>Filtros de B√∫squeda</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="searchForm" class="filter-form">
        <div class="filter-row">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Buscar por t√≠tulo o descripci√≥n</mat-label>
            <input matInput formControlName="searchText" placeholder="Buscar...">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Fecha de inicio</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="startDate">
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Fecha de fin</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="endDate">
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filtrar por usuario</mat-label>
            <input matInput formControlName="userFilter" placeholder="Usuario asignado">
            <mat-icon matSuffix>person</mat-icon>
          </mat-form-field>
          
          <button mat-raised-button color="accent" type="button" (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            Limpiar
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <div class="dashboard-content">
    <!-- Estad√≠sticas por Estado y Prioridad -->
    <div class="charts-row">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Issues por Estado</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-stats">
            <div class="chart-item" *ngFor="let status of getStatusArray()">
              <div class="chart-label">
                <span class="status-badge" [ngClass]="'status-' + status.key">
                    {{ status.key === 'closed' ? 'Cerrado' : status.label }}
                </span>
              </div>
              <div class="chart-value">{{status.value}}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Issues por Prioridad</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-stats">
            <div class="chart-item" *ngFor="let priority of getPriorityArray()">
              <div class="chart-label">
                <span class="priority-badge" [ngClass]="'priority-' + priority.key">
                  {{priority.label}}
                </span>
              </div>
              <div class="chart-value">{{priority.value}}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Estad√≠sticas por Usuario -->
    <mat-card class="user-stats-card">
      <mat-card-header>
        <mat-card-title>Estad√≠sticas por Usuario</mat-card-title>
        <mat-card-subtitle>Distribuci√≥n de issues por usuario asignado</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="user-stats-table">
          <div class="table-header">
            <div class="col">Usuario</div>
            <div class="col">Total</div>
            <div class="col">Pendientes</div>
            <div class="col">En Progreso</div>
            <div class="col">Completados</div>
          </div>
          <div class="table-row" *ngFor="let user of userStats">
            <div class="col user-name">{{user.userName}}</div>
            <div class="col total">{{user.totalIssues}}</div>
            <div class="col todo">{{user.todoIssues}}</div>
            <div class="col progress">{{user.inProgressIssues}}</div>
              <div class="col done">{{user.closedIssues}}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Lista de Issues Filtrados -->
    <mat-card class="issues-list-card">
      <mat-card-header>
        <mat-card-title>
          Issues Encontrados ({{filteredIssues.length}})
        </mat-card-title>
        <div class="card-actions">
          <button mat-raised-button color="primary" (click)="exportToCsv()">
            <mat-icon>download</mat-icon>
            Exportar CSV
          </button>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="issues-table">
          <div class="table-header">
            <div class="col">ID</div>
            <div class="col">T√≠tulo</div>
            <div class="col">Estado</div>
            <div class="col">Prioridad</div>
            <div class="col">Asignado a</div>
            <div class="col">Fecha Creaci√≥n</div>
          </div>
          <div class="table-row" *ngFor="let issue of filteredIssues; let i = index">
            <div class="col">{{issue.issueId}}</div>
            <div class="col issue-title">
              <strong>{{issue.title || issue.issueDescription}}</strong>
              <small class="issue-description">{{issue.description || issue.issueDescription}}</small>
            </div>
            <div class="col">
              <span class="status-badge" [ngClass]="'status-' + issue.issueStataus">
                {{getStatusLabel(issue.issueStataus)}}
              </span>
            </div>
            <div class="col">
              <span class="priority-badge" [ngClass]="'priority-' + issue.issuePriority">
                {{getPriorityLabel(issue.issuePriority)}}
              </span>
            </div>
            <div class="col">{{issue.issueSupervisor || 'Sin Asignar'}}</div>
            <div class="col">{{issue.issueCreateDate | date:'dd/MM/yyyy'}}</div>
          </div>
          
          <div *ngIf="filteredIssues.length === 0" class="no-results">
            <mat-icon>search_off</mat-icon>
            <p>No se encontraron issues con los filtros aplicados</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
